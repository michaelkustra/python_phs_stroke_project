import pandas as pd
from pyprojroot import here
# model packages
import pandas_profiling
# read in mortality data
hb_mortality = pd.read_csv(here("raw_data/stroke_mortalitybyhbr.csv"))
ca_mortality = pd.read_csv(here("raw_data/stroke_mortalitybyca.csv"))
# clean data by removing unnecessary columns and values
hb_mortality_reduced = r.hb_mortality.drop(columns = ['hbrqf', 'age_group_qf', 'sex_qf', 'number_of_deaths_qf', 'crude_rate_qf'])
hb_mortality_reduced = hb_mortality_reduced.query('age_group != "All" & sex != "All"').dropna()
# clean data by removing unnecessary columns and values
hb_mortality_reduced = r.hb_mortality.drop(columns = ['hbrqf', 'age_group_qf', 'sex_qf', 'number_of_deaths_qf', 'crude_rate_qf'])
hb_mortality_reduced = hb_mortality_reduced.query('age_group != "All" & sex != "All"').dropna()
# assign categorical vars dummies
hb_mortality_reduced = pd.get_dummies(hb_mortality_reduced, drop_first = True)
hb_mortality_reduced.head()
# set our response array
response_var = hb_mortality_reduced['number_of_deaths']
# put our predictors in a data frame
predictor_vars = hb_mortality_reduced.drop(columns = 'number_of_deaths')
# create train / test split
from sklearn.model_selection import train_test_split
mortality_pred_train, mortality_pred_test, mortality_resp_train, mortality_resp_test = (
train_test_split(
predictor_vars,
response_var,
test_size = 0.1
)
)
# define model using train data
from sklearn.linear_model import LinearRegression
mortality_model = LinearRegression()
mortality_model.fit(mortality_pred_train, mortality_resp_train)
mortality_model.score(mortality_pred_train, mortality_resp_train)
# check r-squared value of current model
from sklearn.model_selection import cross_val_score
mortality_model.score(mortality_pred_train, mortality_resp_train)
# r-squared scores for each fold
scores = cross_val_score(
mortality_model, mortality_pred_train, mortality_resp_train, scoring='r2', cv=10
)
scores
import numpy as np
print(mortality_model.score(mortality_pred_train, mortality_resp_train))
# mean score of all models
print(np.mean(scores))
# match predictors to coefficients in a df
pd.DataFrame({
'Variable':predictor_vars.columns,
'Coefficients':mortality_model.coef_
})
import statsmodels.api as sm
# add in the constant to the data
predictor_vars = sm.add_constant(predictor_vars)
predictor_vars.head()
# model summary using statsmodels
sm_model = sm.OLS(response_var, predictor_vars).fit()
print(sm_model.summary())
import pandas as pd
from pyprojroot import here
# model packages
import pandas_profiling
# read in mortality data
hb_mortality = pd.read_csv(here("raw_data/stroke_mortalitybyhbr.csv"))
ca_mortality = pd.read_csv(here("raw_data/stroke_mortalitybyca.csv"))
# clean data by removing unnecessary columns and values
hb_mortality_reduced = r.hb_mortality.drop(columns = ['hbrqf', 'age_group_qf', 'sex_qf', 'number_of_deaths_qf', 'crude_rate_qf'])
hb_mortality_reduced = hb_mortality_reduced.query('age_group != "All" & sex != "All"').dropna()
# assign categorical vars dummies
hb_mortality_reduced = pd.get_dummies(hb_mortality_reduced, drop_first = True)
hb_mortality_reduced.head()
# set our response array
response_var = hb_mortality_reduced['number_of_deaths']
# put our predictors in a data frame
predictor_vars = hb_mortality_reduced.drop(columns = 'number_of_deaths')
# create train / test split
from sklearn.model_selection import train_test_split
mortality_pred_train, mortality_pred_test, mortality_resp_train, mortality_resp_test = (
train_test_split(
predictor_vars,
response_var,
test_size = 0.1
)
)
# define model using train data
from sklearn.linear_model import LinearRegression
mortality_model = LinearRegression()
mortality_model.fit(mortality_pred_train, mortality_resp_train)
# check r-squared value of current model
from sklearn.model_selection import cross_val_score
mortality_model.score(mortality_pred_train, mortality_resp_train)
# r-squared scores for each fold
scores = cross_val_score(
mortality_model, mortality_pred_train, mortality_resp_train, scoring='r2', cv=10
)
scores
import numpy as np
print(mortality_model.score(mortality_pred_train, mortality_resp_train))
# mean score of all models
print(np.mean(scores))
# match predictors to coefficients in a df
pd.DataFrame({
'Variable':predictor_vars.columns,
'Coefficients':mortality_model.coef_
})
import statsmodels.api as sm
# add in the constant to the data
predictor_vars = sm.add_constant(predictor_vars)
predictor_vars.head()
# model summary using statsmodels
sm_model = sm.OLS(response_var, predictor_vars).fit()
print(sm_model.summary())
# model score on test data
mortality_model.score(mortality_pred_test, mortality_resp_test)
importance = mortality_model.coef_
# summarize feature importance
for i,v in enumerate(importance):
print('Feature: %0d, Score: %.5f' % (i,v))
# plot feature importance
pyplot.bar([x for x in range(len(importance))], importance)
pyplot.show()
hb_mortality = pd.read_csv(here("raw_data/stroke_mortalitybyhbr.csv"))
# clean data by removing unnecessary columns and values
hb_mortality_reduced = r.hb_mortality.drop(columns = ['hbrqf', 'age_group_qf', 'sex_qf', 'number_of_deaths_qf', 'crude_rate_qf'])
hb_mortality_reduced = hb_mortality_reduced.query('age_group != "All" & sex != "All" & hbr != "S92000003"').dropna()
# assign categorical vars dummies
hb_mortality_reduced = pd.get_dummies(hb_mortality_reduced, drop_first = True)
hb_mortality_reduced.head()
# set our response array
response_var = hb_mortality_reduced['number_of_deaths']
# put our predictors in a data frame
predictor_vars = hb_mortality_reduced.drop(columns = 'number_of_deaths')
# create train / test split
from sklearn.model_selection import train_test_split
mortality_pred_train, mortality_pred_test, mortality_resp_train, mortality_resp_test = (
train_test_split(
predictor_vars,
response_var,
test_size = 0.1
)
)
# define model using train data
from sklearn.linear_model import LinearRegression
mortality_model = LinearRegression()
mortality_model.fit(mortality_pred_train, mortality_resp_train)
# check r-squared value of current model
from sklearn.model_selection import cross_val_score
mortality_model.score(mortality_pred_train, mortality_resp_train)
# r-squared scores for each fold
scores = cross_val_score(
mortality_model, mortality_pred_train, mortality_resp_train, scoring='r2', cv=10
)
scores
import numpy as np
print(mortality_model.score(mortality_pred_train, mortality_resp_train))
# mean score of all models
print(np.mean(scores))
# match predictors to coefficients in a df
pd.DataFrame({
'Variable':predictor_vars.columns,
'Coefficients':mortality_model.coef_
})
import statsmodels.api as sm
# add in the constant to the data
predictor_vars = sm.add_constant(predictor_vars)
predictor_vars.head()
# model summary using statsmodels
sm_model = sm.OLS(response_var, predictor_vars).fit()
print(sm_model.summary())
# model score on test data
mortality_model.score(mortality_pred_test, mortality_resp_test)
# model score on test data
mortality_model.score(mortality_pred_test, mortality_resp_test)
# get importance from model with coefficients
importance = mortality_model.coef_
# summarise feature importance
for i,v in enumerate(importance):
print('Feature: %0d, Score: %.5f' % (i,v))
# plot feature importance
pyplot.bar([x for x in range(len(importance))], importance)
pyplot.show()
# model score on test data
mortality_model.score(mortality_pred_test, mortality_resp_test)
library(reticulate)
library(tidyverse)
reticulate::repl_python()
reticulate::repl_python()
library(reticulate)
library(tidyverse)
reticulate::repl_python()
# wrangle total populations for each council area
pop_reduced <- py$pop_reduced %>%
filter(Year == "2019") %>%
janitor::clean_names() %>%
group_by(council_area) %>%
summarise(total_popn = sum(population))
reticulate::repl_python()
council_data_r <- py$council_data %>%
filter(NumberOfDeaths != "NaN" & CA != "S92000003")
View(council_data_r)
council_data_r <- py$council_data %>%
filter(NumberOfDeaths != "NaN")
View(council_data_r)
council_data_r <- py$council_data %>%
filter(NumberOfDeaths != "NaN" | CA != "S92000003")
View(council_data_r)
council_data_r <- py$council_data %>%
filter(NumberOfDeaths != "NaN" & CA != "S92000003")
View(council_data_r)
reticulate::repl_python()
